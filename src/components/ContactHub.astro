---
/**
 * ContactHub — toggle-tab component: "Send a Message" / "Book a Call"
 * Inspired by Uptalent.io's contact section UX.
 * Left panel: two toggle tabs + trust copy.
 * Right panel: swaps between ContactForm and CalendlyInline.
 */
import ContactForm from './ContactForm.astro';
import CalendlyInline from './CalendlyInline.astro';

export type Props = {
	subject?: string;
	calendlyUrl?: string;
	defaultCategory?: 'aec' | 'design' | 'marketing' | '';
	/** @deprecated — use defaultCategory */
	defaultInterest?: string;
	defaultMessage?: string;
	heading?: string;
	subheading?: string;
};

const {
	subject = 'LatAm Scalers — new inquiry',
	calendlyUrl = import.meta.env.PUBLIC_CALENDLY_URL ?? import.meta.env.PUBLIC_BOOKING_URL ?? 'https://calendly.com/alejandra-latamscalers/30min',
	defaultCategory = (Astro.props.defaultCategory ?? Astro.props.defaultInterest ?? '') as 'aec' | 'design' | 'marketing' | '',
	defaultMessage = '',
	heading = 'Get in Touch',
	subheading = 'Send us a message with your requirements, or book a quick scoping call — whatever works best for you.',
} = Astro.props;

const hubId = `hub-${Math.random().toString(36).slice(2, 8)}`;
---

<div id={hubId} class="contact-hub" data-contact-hub>
	{/* Outer wrapper with a subtle glow to differentiate from page */}
	<div class="relative rounded-3xl border border-sky-500/20 bg-gradient-to-br from-slate-900 via-slate-900/95 to-slate-950 shadow-2xl shadow-sky-900/10">

		{/* Top accent bar */}
		<div class="h-1 rounded-t-3xl bg-gradient-to-r from-sky-500 via-sky-400 to-cyan-400"></div>

		<div class="grid gap-0 lg:grid-cols-[380px_1fr]">

			{/* Left panel: toggle tabs + trust copy */}
			<div class="flex flex-col gap-4 p-7 lg:border-r lg:border-slate-800/60 lg:p-8">

				<h2 class="text-2xl font-bold tracking-tight text-white lg:text-[1.65rem]">{heading}</h2>
				<p class="text-[0.9rem] leading-relaxed text-slate-300">{subheading}</p>

				{/* Tab buttons */}
				<div class="mt-2 flex flex-col gap-3">
					<button
						type="button"
						class="group flex w-full items-center justify-between rounded-xl px-5 py-5 text-left transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-300 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950"
						data-hub-tab="form"
						aria-selected="true"
						role="tab"
					>
						<div>
							<p class="text-base font-semibold leading-snug" data-tab-title>Send us a message</p>
							<p class="mt-1 text-sm" data-tab-sub>We reply within a few hours</p>
						</div>
						<svg class="h-5 w-5 shrink-0 opacity-0 transition-opacity" data-tab-arrow viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd"/></svg>
					</button>

					<button
						type="button"
						class="group flex w-full items-center justify-between rounded-xl px-5 py-5 text-left transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-300 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950"
						data-hub-tab="calendly"
						aria-selected="false"
						role="tab"
					>
						<div>
							<p class="text-base font-semibold leading-snug" data-tab-title>Book a 30-min scoping call</p>
							<p class="mt-1 text-sm" data-tab-sub>Speak with Alejandra directly</p>
						</div>
						<svg class="h-5 w-5 shrink-0 opacity-0 transition-opacity" data-tab-arrow viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd"/></svg>
					</button>
				</div>

				{/* Trust points */}
				<div class="mt-auto space-y-2.5 border-t border-slate-700/50 pt-6 text-[0.8rem] leading-relaxed text-slate-400">
					<p class="flex items-start gap-2"><span class="mt-0.5 text-sky-400">&#10003;</span> Pre-vetted talent — less than 3% of applicants pass</p>
					<p class="flex items-start gap-2"><span class="mt-0.5 text-sky-400">&#10003;</span> Month-to-month flexibility</p>
					<p class="flex items-start gap-2"><span class="mt-0.5 text-sky-400">&#10003;</span> Free replacement guarantee</p>
					<p class="flex items-start gap-2"><span class="mt-0.5 text-sky-400">&#10003;</span> 50–70% cost savings vs. US hires</p>
				</div>
			</div>

			{/* Right: content panel */}
			<div class="min-h-[500px]">

				{/* Form panel */}
				<div class="p-5 sm:p-7" data-hub-panel="form">
					<ContactForm
						subject={subject}
						defaultCategory={defaultCategory}
						defaultMessage={defaultMessage}
					/>
				</div>

				{/* Calendly panel */}
				<div class="hidden p-5 sm:p-7" data-hub-panel="calendly">
					<CalendlyInline url={calendlyUrl} title="Book a 30-Minute Scoping Call" height={700} />
				</div>
			</div>
		</div>
	</div>
</div>

<script is:inline>
(function () {
  document.querySelectorAll('[data-contact-hub]').forEach(function (hub) {
    var tabs   = hub.querySelectorAll('[data-hub-tab]');
    var panels = hub.querySelectorAll('[data-hub-panel]');

    function activate(name) {
      tabs.forEach(function (tab) {
        var isActive = tab.dataset.hubTab === name;
        tab.setAttribute('aria-selected', isActive ? 'true' : 'false');

        if (isActive) {
          tab.style.backgroundColor = 'rgba(2,132,199,0.12)';
          tab.style.border = '1px solid rgba(14,165,233,0.35)';
        } else {
          tab.style.backgroundColor = '';
          tab.style.border = '1px solid transparent';
        }

        var titleEl = tab.querySelector('[data-tab-title]');
        var subEl   = tab.querySelector('[data-tab-sub]');
        var arrow   = tab.querySelector('[data-tab-arrow]');

        if (titleEl) titleEl.style.color = isActive ? 'rgb(240,249,255)' : 'rgb(148,163,184)';
        if (subEl)   subEl.style.color   = isActive ? 'rgb(125,211,252)' : 'rgb(100,116,139)';
        if (arrow)   arrow.style.opacity = isActive ? '1' : '0';
        if (arrow)   arrow.style.color   = isActive ? 'rgb(56,189,248)' : '';
      });

      panels.forEach(function (panel) {
        panel.classList.toggle('hidden', panel.dataset.hubPanel !== name);
      });
    }

    activate('form');

    tabs.forEach(function (tab) {
      tab.addEventListener('click', function () {
        activate(tab.dataset.hubTab);
      });
    });
  });
})();
</script>

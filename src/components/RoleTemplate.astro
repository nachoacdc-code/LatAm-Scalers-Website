---
import ContactForm from './ContactForm.astro';
import CalendlyEmbed from './CalendlyEmbed.astro';
import { BOOKING_URL, isExternalUrl } from '../lib/cta';

export type Props = {
	role: string;
	category: 'aec' | 'design' | 'marketing';
	title: string;
	description: string;
	h1: string;
	overview: string;
	whyRemote: string;
	tools: { name: string; description: string }[];
	deliverables: string[];
	engagementOptions: { title: string; description: string }[];
	pricing: string;
	relatedRoles: { title: string; href: string; category: string }[];
	faq: { question: string; answer: string }[];
};

const {
	role,
	category,
	title,
	description,
	h1,
	overview,
	whyRemote,
	tools,
	deliverables,
	engagementOptions,
	pricing,
	relatedRoles,
	faq,
} = Astro.props;

const bookingUrl = BOOKING_URL;
const bookingExternal = isExternalUrl(bookingUrl);
const calendlyUrl = import.meta.env.PUBLIC_CALENDLY_URL ?? 'https://calendly.com/your-org/15min';

const categoryLabels: Record<string, string> = {
	aec: 'AEC',
	design: 'Design',
	marketing: 'Marketing',
};

const categoryColors: Record<string, string> = {
	aec: 'text-aec',
	design: 'text-design',
	marketing: 'text-marketing',
};
---

{/* 1. HERO */}
<section class="relative overflow-hidden bg-slate-950">
	<div class="mx-auto max-w-6xl px-6 py-16 sm:py-20">
		<div class="grid items-center gap-10 lg:grid-cols-2">
			<div>
				<p class={`text-sm font-semibold tracking-wide ${categoryColors[category]}`}>
					{categoryLabels[category]} Role
				</p>
				<h1 class="mt-4 text-4xl font-semibold tracking-tight text-white sm:text-5xl">
					{h1}
				</h1>
				<p class="mt-4 max-w-prose text-base leading-relaxed text-slate-400 sm:text-lg">
					{description}
				</p>
				<div class="mt-8 flex flex-wrap gap-3">
					<a
						href={bookingUrl}
						{...(bookingExternal ? { target: '_blank', rel: 'noreferrer' } : {})}
						class="inline-flex items-center justify-center rounded bg-sky-600 px-5 py-2.5 text-sm font-semibold text-white transition hover:opacity-90 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2"
						data-book-call
					>
						Book a 15-Min Call
					</a>
					<a
						href="/#contact"
						class="inline-flex items-center justify-center rounded-xl border border-white/20 bg-white/5 px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2"
						data-open-tell-us="role-hero"
						data-role={role}
					>
						Tell Us Your Needs
					</a>
				</div>
			</div>

			{/* 2. AT A GLANCE sidebar */}
			<div class="relative">
				<div class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-sm p-6 shadow-sm">
					<p class="text-xs font-semibold uppercase tracking-wide text-slate-400">At a glance</p>
					<ul class="mt-4 grid gap-3 sm:grid-cols-2">
						<li class="rounded-xl border border-white/10 bg-white/5 p-4">
							<p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Category</p>
							<p class="mt-2 text-sm text-slate-400">{categoryLabels[category]}</p>
						</li>
						<li class="rounded-xl border border-white/10 bg-white/5 p-4">
							<p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Tools</p>
							<p class="mt-2 text-sm text-slate-400">{tools.slice(0, 3).map((t) => t.name).join(', ')}</p>
						</li>
						<li class="rounded-xl border border-white/10 bg-white/5 p-4">
							<p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Pricing</p>
							<p class="mt-2 text-sm text-slate-400">{pricing}</p>
						</li>
						<li class="rounded-xl border border-white/10 bg-white/5 p-4">
							<p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Flexibility</p>
							<p class="mt-2 text-sm text-slate-400">20h / 40h or team scaling</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</section>

{/* 3. OVERVIEW */}
<section class="bg-slate-900/40 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold text-slate-100">Role Overview</h2>
		<p class="mt-4 max-w-prose text-sm leading-relaxed text-slate-400 sm:text-base">
			{overview}
		</p>
	</div>
</section>

{/* 4. WHY REMOTE LATAM */}
<section class="bg-slate-950 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold text-slate-100">Why Hire a Remote {role} from LATAM?</h2>
		<p class="mt-4 max-w-prose text-sm leading-relaxed text-slate-400 sm:text-base">
			{whyRemote}
		</p>
		<ul class="mt-6 grid gap-3 sm:grid-cols-2">
			<li class="rounded-xl border border-slate-800 bg-slate-900/40 px-4 py-3 text-sm text-slate-300">
				50–70% cost savings vs. US-based hires
			</li>
			<li class="rounded-xl border border-slate-800 bg-slate-900/40 px-4 py-3 text-sm text-slate-300">
				Timezone-aligned (EST/CST/PST overlap)
			</li>
			<li class="rounded-xl border border-slate-800 bg-slate-900/40 px-4 py-3 text-sm text-slate-300">
				Fluent English, pre-vetted for tools & culture
			</li>
			<li class="rounded-xl border border-slate-800 bg-slate-900/40 px-4 py-3 text-sm text-slate-300">
				Scale up or down with no long-term contracts
			</li>
		</ul>
	</div>
</section>

{/* 5. ENGAGEMENT OPTIONS */}
<section class="bg-slate-900/40 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold text-slate-100">Engagement Options</h2>
		<div class="mt-6 grid gap-4 md:grid-cols-2">
			{engagementOptions.map((opt) => (
				<article class="rounded-2xl border border-slate-800 bg-slate-900/40 p-6">
					<h3 class="text-base font-semibold text-slate-100">{opt.title}</h3>
					<p class="mt-3 text-sm leading-relaxed text-slate-400">{opt.description}</p>
				</article>
			))}
		</div>
	</div>
</section>

{/* 6. TOOLS */}
<section class="bg-slate-950 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold text-slate-100">Tools & Technologies</h2>
		<div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
			{tools.map((tool) => (
				<div class="rounded-xl border border-slate-800 bg-slate-900/40 p-5">
					<p class="text-sm font-semibold text-slate-100">{tool.name}</p>
					<p class="mt-2 text-sm leading-relaxed text-slate-400">{tool.description}</p>
				</div>
			))}
		</div>
	</div>
</section>

{/* 7. SAMPLE DELIVERABLES */}
<section class="bg-slate-900/40 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold text-slate-100">Sample Deliverables</h2>
		<ul class="mt-6 grid gap-3 sm:grid-cols-2">
			{deliverables.map((d) => (
				<li class="flex items-start gap-3 rounded-xl border border-slate-800 bg-slate-900/40 px-4 py-3">
					<span class="mt-0.5 flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-sky-500/10 text-sky-300 text-xs font-bold" aria-hidden="true">✓</span>
					<span class="text-sm text-slate-400">{d}</span>
				</li>
			))}
		</ul>
	</div>
</section>

{/* 8. PRICING GUIDANCE */}
<section class="bg-slate-950 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold text-slate-100">Pricing Guidance</h2>
		<div class="mt-6 rounded-2xl border border-slate-800 bg-slate-900/40 p-6">
			<p class="text-sm leading-relaxed text-slate-400 sm:text-base">{pricing}</p>
			<p class="mt-4 text-sm text-slate-400">
				Final pricing depends on experience level, hours per week, and engagement model. Book a call for a personalized quote.
			</p>
			<a
				href={bookingUrl}
				{...(bookingExternal ? { target: '_blank', rel: 'noreferrer' } : {})}
				class="mt-5 inline-flex items-center justify-center rounded bg-sky-600 px-5 py-2.5 text-sm font-semibold text-white transition hover:opacity-90 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-300 focus-visible:ring-offset-2"
				data-book-call
			>
				Get a Custom Quote
			</a>
		</div>
	</div>
</section>

{/* 9. RELATED ROLES */}
<section class="bg-slate-900/40 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold text-slate-100">Related Roles</h2>
		<div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
			{relatedRoles.map((r) => (
				<a
					href={r.href}
					class="group rounded-xl border border-slate-800 bg-slate-900/40 p-5 transition hover:bg-slate-900 hover:-translate-y-0.5 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-300"
				>
					<span class={`text-xs font-semibold uppercase tracking-wide ${categoryColors[r.category] ?? 'text-slate-400'}`}>
						{categoryLabels[r.category] ?? r.category}
					</span>
					<p class="mt-2 text-sm font-semibold text-slate-100 group-hover:text-sky-200 transition-colors">{r.title}</p>
					<p class="mt-2 text-sm font-semibold text-sky-300">View role →</p>
				</a>
			))}
		</div>
	</div>
</section>

{/* 10. FAQ */}
<section class="bg-slate-950 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold text-slate-100">Frequently Asked Questions</h2>
		<div class="mt-6 space-y-3">
			{faq.map((item) => (
				<details class="group rounded-xl border border-slate-800 bg-slate-900/40">
					<summary class="flex cursor-pointer items-center justify-between px-5 py-4 text-sm font-semibold text-slate-100 transition hover:text-sky-200">
						{item.question}
						<span class="ml-3 shrink-0 text-slate-400 transition-transform group-open:rotate-45" aria-hidden="true">+</span>
					</summary>
					<div class="px-5 pb-4 text-sm leading-relaxed text-slate-400">
						{item.answer}
					</div>
				</details>
			))}
		</div>
	</div>
</section>

{/* 11. CTA */}
<section class="bg-slate-950 js-fade-in">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<div class="flex flex-col items-start justify-between gap-6 md:flex-row md:items-center">
			<div>
				<h2 class="text-2xl font-semibold tracking-tight text-white sm:text-3xl">
					Hire a {role} — Book a Call
				</h2>
				<p class="mt-2 max-w-prose text-sm leading-relaxed text-slate-400 sm:text-base">
					Tell us your requirements and we'll recommend the best engagement model and match you with pre-vetted talent fast.
				</p>
			</div>
			<div class="flex flex-wrap gap-3">
				<a
					href={bookingUrl}
					{...(bookingExternal ? { target: '_blank', rel: 'noreferrer' } : {})}
					class="inline-flex items-center justify-center rounded bg-sky-600 px-5 py-2.5 text-sm font-semibold text-white transition hover:opacity-90 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2"
					data-book-call
				>
					Book a 15-Min Call
				</a>
				<a
					href="/roles/"
					class="inline-flex items-center justify-center rounded-xl border border-white/20 bg-white/5 px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2"
				>
					Browse All Roles
				</a>
			</div>
		</div>
	</div>
</section>

{/* CONTACT FORM + CALENDLY */}
<section class="bg-slate-950" id="contact">
	<div class="mx-auto max-w-6xl px-6 py-14">
		<h2 class="text-2xl font-semibold tracking-tight text-slate-100 sm:text-3xl">Contact Us</h2>
		<p class="mt-2 max-w-prose text-sm leading-relaxed text-slate-400 sm:text-base">
			Send us your requirements or book a call directly.
		</p>
		<div class="mt-8 grid gap-6 lg:grid-cols-2">
			<ContactForm subject={`LatAm Scalers — inquiry (role: ${role})`} role={role} defaultInterest={category === 'aec' ? 'aec' : category === 'design' ? 'design' : 'marketing'} />
			<CalendlyEmbed url={calendlyUrl} title={`Book a call about ${role}`} />
		</div>
	</div>
</section>

<script is:inline>
(() => {
	const observer = new IntersectionObserver(
		(entries) => {
			entries.forEach((e) => {
				if (e.isIntersecting) {
					e.target.classList.add('fade-in-visible');
					observer.unobserve(e.target);
				}
			});
		},
		{ threshold: 0.1 }
	);
	document.querySelectorAll('.js-fade-in').forEach((el) => observer.observe(el));
})();
</script>

<style>
	.js-fade-in {
		opacity: 0;
		transform: translateY(16px);
		transition: opacity 0.5s ease, transform 0.5s ease;
	}
	.fade-in-visible {
		opacity: 1;
		transform: translateY(0);
	}
</style>
